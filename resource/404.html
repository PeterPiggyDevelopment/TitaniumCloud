<!DOCTYPE HTML>
<html>
    <head>
        <title>404 -- Not Found</title>
        <h1 align='center'>404 -- Not Found</h1>
        <h1 align='center'>But A Snake Found!</h1>
        
    </head>
    <body>
        <object style="border:2px solid #000000;" id='snakeArea' width="800" height="800" type="image/svg+xml" data="/resource/snake.svg"></object>
    </body>
    <script src='/resource/js/jquery.js'></script>
    <script>
        window.onload=drawSnake;
        var upperBorder=80;
        var lowerBorder=0;
        var AC=10;
        var Length=3;
        var IsGaming=true;
        var Apple=[AC*8, AC*5];
        var AppleRad=AC;
        var Snake=[[AC, AC], [AC, AC*2], [AC*2, AC*2], [AC*2, AC*3]];
        function drawSnake(){
            var svgDoc = document.getElementById('snakeArea').contentDocument;
            var svggr =  svgDoc.getElementById('svggr');
            while (svggr.firstChild) {
                    svggr.removeChild(svggr.firstChild);
            }
            var circle = svgDoc.createElementNS("http://www.w3.org/2000/svg",'circle');
            circle.setAttribute('cx', Apple[0]);
            circle.setAttribute('cy', Apple[1]);
            circle.setAttribute('r', AppleRad);
            circle.setAttribute('fill', 'green');
            svggr.appendChild(circle);
            for (var i=0; i<Length-1; i++){
                var line = svgDoc.createElementNS("http://www.w3.org/2000/svg",'line');
                line.setAttribute('x1', Snake[i][0]);
                line.setAttribute('y1', Snake[i][1]);
                line.setAttribute('x2', Snake[i+1][0]);
                line.setAttribute('y2', Snake[i+1][1]);
                line.setAttribute('style', 
                        "stroke:rgb(255,0,0);stroke-width:"+AC+";stroke-linecap:round;");
                svggr.appendChild(line);
            }
        }

        $(document).bind('keypress', function (e){
            if(IsGaming){
                if(e.which== 104){//h-left
                    if(!(Snake[Length-2][0]==Snake[Length-1][0]-AC
                            && Snake[Length-2][1]==Snake[Length-1][1])){
                        if(!headEquals(Apple[0], Apple[1])){
                            Snake=rolLeft(Snake);
                            Snake[Length-1]=[];
                            Snake[Length-1][0]=Snake[Length-2][0]-AC;
                            Snake[Length-1][1]=Snake[Length-2][1];
                            drawSnake();
                        } else {
                            genNewApple();
                            drawSnake();
                            Length++;
                            Snake[Length-1]=[];
                            Snake[Length-1][0]=Snake[Length-2][0]-AC;
                            Snake[Length-1][1]=Snake[Length-2][1];
                            drawSnake();
                        }
                    }
                } else if(e.which== 106){//j-down
                    if(!(Snake[Length-2][0]==Snake[Length-1][0]
                            && Snake[Length-2][1]==Snake[Length-1][1]+AC)){
                        if(!headEquals(Apple[0], Apple[1])){
                            Snake=rolLeft(Snake);
                            Snake[Length-1]=[];
                            Snake[Length-1][0]=Snake[Length-2][0];
                            Snake[Length-1][1]=Snake[Length-2][1]+AC;
                            drawSnake();
                        } else {
                            genNewApple();
                            drawSnake();
                            Length++;
                            Snake[Length-1]=[];
                            Snake[Length-1][0]=Snake[Length-2][0];
                            Snake[Length-1][1]=Snake[Length-2][1]+AC;
                            drawSnake();
                        }
                    }
                } else if(e.which== 107){//k-up
                    if(!(Snake[Length-2][0]==Snake[Length-1][0]
                            && Snake[Length-2][1]==Snake[Length-1][1]-AC)){
                        if(!headEquals(Apple[0], Apple[1])){
                            Snake=rolLeft(Snake);
                            Snake[Length-1]=[];
                            Snake[Length-1][0]=Snake[Length-2][0];
                            Snake[Length-1][1]=Snake[Length-2][1]-AC;
                            drawSnake();
                        } else {
                            genNewApple();
                            drawSnake();
                            Length++;
                            Snake[Length-1]=[];
                            Snake[Length-1][0]=Snake[Length-2][0];
                            Snake[Length-1][1]=Snake[Length-2][1]-AC;
                            drawSnake();
                        }
                    }
                } else if(e.which== 108){//l-right
                    if(!(Snake[Length-2][0]==Snake[Length-1][0]+AC
                            && Snake[Length-2][1]==Snake[Length-1][1])){
                        if(!headEquals(Apple[0], Apple[1])){
                            Snake=rolLeft(Snake);
                            Snake[Length-1]=[];
                            Snake[Length-1][0]=Snake[Length-2][0]+AC;
                            Snake[Length-1][1]=Snake[Length-2][1];
                            drawSnake();
                        } else {
                            genNewApple();
                            drawSnake();
                            Length++;
                            Snake[Length-1]=[];
                            Snake[Length-1][0]=Snake[Length-2][0]+AC;
                            Snake[Length-1][1]=Snake[Length-2][1];
                            drawSnake();
                        }
                    }
                }
                if(((Snake[Length-1][0]<=lowerBorder) || (Snake[Length-1][0]>=AC*upperBorder))
                    || (Snake[Length-1][1]>=AC*upperBorder || Snake[Length-1][1]<=lowerBorder)
                    ||isHeadOnTail()){
                    var svgDoc = document.getElementById('snakeArea').contentDocument;
                    var svggr =  svgDoc.getElementById('svggr');
                    var line = svgDoc.createElementNS("http://www.w3.org/2000/svg",'text');
                    line.setAttribute('x', AC*6);
                    line.setAttribute('y', AC*2);
                    line.setAttribute('fill', 'red');
                    line.setAttribute('transform', 'rotate(30 20,40)');
                    line.setAttribute('style', 'font-size:60;');
                    line.textContent='GAME OVER';
                    svggr.appendChild(line);
                    IsGaming=false;
                }
            }
        });

        function headEquals(x,y){
            return (Snake[Length-1][0]==x && Snake[Length-1][1]==y)? true : false;
        }

        function rolLeft(list){
            var newlist=[];
            for(var i=Length-1; i>0; i--){
                newlist[i-1]=list[i];
            }
            return newlist;
        }

        function isHeadOnTail(){
            var counter=0;
            for(var i=0; i<Length-2;i++){
                if ((Snake[i][0]==Snake[Length-1][0]))counter++;
            }
        }

        function genNewApple(){
            Apple[0]=(Math.floor((Math.random() * (upperBorder-1)) + (lowerBorder+1)))*AC;
            Apple[1]=(Math.floor((Math.random() * (upperBorder-1)) + (lowerBorder+1)))*AC;
        }
    </script>
</html>
